%\listfiles
\documentclass[english,ngerman,ttfont=roboto,cd=foo]{tudscrmanual}
\iftutex
  \usepackage{fontspec}
\else
  \usepackage[T1]{fontenc}
  \input glyphtounicode.tex
  \pdfgentounicode=1
  \usepackage[ngerman=ngerman-x-latest]{hyphsubst}
\fi
\lstset{%
  inputencoding=utf8,extendedchars=true,
  literate=%
    {ä}{{\"a}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
    {Ä}{{\"A}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
    {~}{{\textasciitilde}}1 {ß}{{\ss}}1
}

\usepackage{widows-and-orphans}

\KOMAoptions{headings=optiontoheadandtoc}

\tracinglabels<>[created,stuff,matched]
%\tracingmarkup
\usepackage{blindtext}
\usepackage{bookmark}

\begin{document}
\section{title}

\newcommand*\cdalias{false,true,lightcolor,barcolor,bicolor,color,fullcolor}

\begin{Declaration}{\Option{cdtitle=\PMisc}}[aaa|foo]<\cdalias>
\printdeclarationlist%

fff
\end{Declaration}

\end{document}

\begin{Declaration}[v2.03]{\Option{tudscrver=\PMisc}}[last]<aaa>
\begin{Declaration}[v2.03]{\Option{tudscrversion=\PMisc}}[last]
\printdeclarationlist%
%
\begin{DeclarationValues}
\itemval=2.02,first=
  Der Satzspiegel im Layout des \CDs
\itemval*=gugge,oder,was=
\end{DeclarationValues}
\end{Declaration}
\end{Declaration}

\Package{stuff}

\Option{tudscrver=bbb}

\Option{tudscrver=aaa}

\end{document}

\section{title}
\begin{Declaration}{\Option{bla}}<hallo>
\printdeclarationlist%
\begin{DeclarationValues}
\itemvalfalse
  Es werden die
\end{DeclarationValues}
\end{Declaration}

\begin{Declaration}{\Option{bla}(\Bundle{foo})}
\printdeclarationlist%
\end{Declaration}

\Bundle{latex-base}

und sonst 

\Bundle{latex-base}

%\begin{Declaration}{\Macro{bla}(\Package{foo})}
%\printdeclarationlist%
%\end{Declaration}
\typeout{------------------------}
\Option{bla=false}

%\begin{Entity}{\Bundle{foo}}
\Option{bla=false}(\Bundle{foo})


\Package{stuff}
%\end{Entity}

%\AfterReadingMainAux{%
%  \wlog{Hallo}
%  tudscrsupervisor:environment:evaluation/headline 
%'tudscrsupervisor:environment:evaluation/headline=<3:Überschrift>'
%}

\end{document}

Für das \CD sind mehrere Farben vorgesehen. Die prägnanteste aller ist die 
Hausfarbe \Color{HKS41}, danach folgen die Farben für Auszeichnungen der ersten
(\Color{HKS44}) und der zweiten Kategorie (\Color{HKS36}, \Color{HKS33}, 
\Color{HKS57}, \Color{HKS65}) sowie eine Ausnahmefarbe (\Color{HKS07}). 
Diese Farben dürfen sowohl in ihrer Grundform als auch in helleren Tönen mit 
einer Abstufung in 10\,\%"~Schritten verwendet werden. Das ohnehin verwendete 
Paket \Package{xcolor} stellt genau diese Funktionalität zur Verfügung. Jede 
der Farben kann sowohl mit \Color*{HKS\PName{Zahl}} als auch über ein Pseudonym 
\Color*{cd\PName{Farbe}} genutzt werden.
%
\begin{Example*}
Die Grundfarbe \Color{HKS44} soll in der auf 20\% reduzierten, helleren 
Abstufung genutzt werden. Innerhalb eines Befehls, der als Argument eine 
gültige Farbe erwartet, muss lediglich \PValue{HKS44!20} angegeben werden. 
Dies wird hier exemplarisch mit der folgenden \colorbox{HKS44!20}{%
  Box \Macro{colorbox}[%
    \PParameter{HKS44!20}\PParameter{Box}%
  ](\Package{xcolor})%
}
demonstriert.
\end{Example*}
%
Bei der farbigen Gestaltung des \CDs (\Option{cd=color}) ist der Hintergrund 
von Umschlagseite, Titel sowie Teilen in \Color{HKS41} und die Schrift auf 
selbigen in \Color{HKS41}[!30] gehalten. Der Hintergrund von Kapitelseiten 
erscheint in \Color{HKS41}[!10], die Schrift in \Color{HKS41}. Bei geringerem 
Farbeinsatz werden lediglich die Schriften der Gliederungsseiten auf 
\Color{HKS41} gesetzt.

Sollen bestimmte Optionen an das Paket \Package{xcolor} weitergereicht werden, 
gibt es dafür zwei Möglichkeiten. Diese kann entweder vor dem Laden der Klasse 
direkt an \Package{xcolor} übergeben werden%
\footnote{%
  \Macro{PassOptionsToPackage}[\Parameter{Paketoptionen}\PParameter{xcolor}]
  vor dem Laden der genutzten Dokumentklasse mit
  \Macro*{documentclass}[\OParameter{Klassenoptionen}\Parameter{Klasse}]%
}
oder es wird \Package{tudscrcolor} mit der entsprechenden Option geladen.%
\footnote{%
  \Macro*{usepackage}[\OParameter{Paketoptionen}\PParameter{tudscrcolor}];
  \Package{tudscrcolor} reicht \PName{Paketoptionen} an \Package{xcolor} weiter%
}
\newcommand*\cdcolorcalc{}
\newcommand*\cdcolorname{}
\newcommand*\cdcolorvalue{}
\newcommand*\cdcolortext{}
\newcommand*\cdcolor[2][0]{%
  \vskip\medskipamount\noindent%
  \begin{tikzpicture}[%
    every node/.style={%
      rectangle, minimum height=.1\linewidth, minimum width=7em%
    }%
  ]%
  \def\cdcolorcalc##1##2{%
    \pgfmathparse{100-##1*10}%
    \xdef\cdcolorname{HKS##2!\pgfmathresult}%
    \xdef\cdcolorvalue{\pgfmathresult}%
    \pgfmathparse{10+##1*10}%
  }%
  \foreach \x in {0,1,...,9}{%
    \cdcolorcalc{\x}{#2}%
    \ifnum\x<#1%
      \def\cdcolortext{white}%
    \else%
      \def\cdcolortext{black}%
    \fi%
    \node [fill=\cdcolorname,rotate=90] at (.\x\linewidth,0)%
      {\textcolor{\cdcolortext}{HKS#2!\pgfmathprintnumber\cdcolorvalue}};%
  }%
  \end{tikzpicture}%
  \par%
}



\subsection{Generelle Farbdefinitionen}
\minisec{Primäre Hausfarbe}
\begin{Declaration}{\Color{HKS41}[cddarkblue]}
\printdeclarationlist%
\cdcolor[6]{41}
\end{Declaration}

\minisec{Sekundäre Hausfarbe (Geschäftsausstattung)}
\begin{Declaration}{\Color{HKS92}[cdgray]}
\printdeclarationlist%
\cdcolor[4]{92}
\end{Declaration}

\minisec{Auszeichnungsfarbe 1.\,Kategorie}
\begin{Declaration}{\Color{HKS44}[cdblue]}
\printdeclarationlist%
\cdcolor[4]{44}
\end{Declaration}

\minisec{Auszeichnungsfarbe 2.\,Kategorie}
\begin{Declaration}{\Color{HKS36}[cdindigo]}
\begin{Declaration}{\Color{HKS33}[cdpurple]}
\begin{Declaration}{\Color{HKS57}[cddarkgreen]}
\begin{Declaration}{\Color{HKS65}[cdgreen]}
\printdeclarationlist%
\cdcolor[4]{36}
\cdcolor[4]{33}
\cdcolor[2]{57}
\cdcolor{65}
\end{Declaration}
\end{Declaration}
\end{Declaration}
\end{Declaration}

\minisec{Ausnahmefarbe}
\begin{Declaration}{\Color{HKS07}[cdorange]}
\printdeclarationlist%
\cdcolor{07}
\end{Declaration}



\subsection{Zusätzliche Farbdefinitionen}
%
\begin{Declaration}{\Option{reduced}}[]
\printdeclarationlist%
%
Das Paket \Package{tudscrcolor} definiert lediglich die zuvor beschriebenen 
Grundfarben \Color{HKS41}, \Color{HKS92}, \Color{HKS44}, \Color{HKS36}, 
\Color{HKS33}, \Color{HKS57}, \Color{HKS65} sowie \Color{HKS07}. 
Alle anderen farblichen Abstufungen können mit den beschrieben Möglichkeiten 
des Paketes \Package{xcolor} generiert werden.
\end{Declaration}

\begin{Declaration}{\Option{extended}}
\printdeclarationlist%
%
Neben dem \TUDScript-Bundle existieren viele verschiedene Klassen und Pakete 
für das \CD, welche teilweise abweichende Farbdefinitionen nutzen. Durch die 
Paketoption \Option{extended} werden hierfür Farben nach dem Schema 
\Color*{HKS41K\PName{Zahl}} und \Color*{HKS41-\PName{Zahl}} definiert, wobei 
der angestellte Zahlenwert aus der 10er"~Reihe kommen muss.
\end{Declaration}



\subsection{Umstellung des Farbmodells}
\index{Farben!Farbmodell}%
%
Normalerweise verwendet \Package{tudscrcolor} das CMYK"~Farbmodell. Außerdem 
wird weiterhin noch der RGB"~Farbraum unterstützt. Eine Umschaltung des 
Farbmodells ist beispielsweise für gewisse Funktionen des Paketes 
\Package{tikz} notwendig.

\begin{Declaration}{\Option{RGB}}
\printdeclarationlist%
%
Diese Option wird an das Paket \Package{xcolor} durchgereicht, wodurch bereits 
beim Laden des Paketes die globale Farbdefinition nicht nach dem 
CMYK"~Farbmodell sondern im RGB"~Farbraum erfolgt.
\end{Declaration}

\begin{Declaration}{\Macro{setcdcolors}[\Parameter{Farbmodell}]}
\printdeclarationlist%
%
Mit diesem Befehl kann innerhalb des Dokumentes das verwendete Farbmodell 
angepasst werden. Damit ist es möglich, lokal innerhalb einer Umgebung den 
Farbmodus zu ändern und so nur in bestimmten Situationen beispielsweise aus dem 
CMYK"~Farbmodell in den RGB"~Farbraum zu wechseln. Unterstützte Werte für 
\PName{Farbmodell} sind \PValue{CMYK} und \PValue{RGB} beziehungsweise 
\PValue{rgb}.
\end{Declaration}

\smallskip\noindent
\Attention{%
  Die Darstellung der Farben kann im jeweiligen Farbmodus 
  (\PValue{CMYK} oder \PValue{RGB}) je nach verwendeter Bildschirm"~, Drucker- 
  und Softwarekonfiguration verschieden ausfallen. Die Farbwerte entstammen dem 
  Handbuch zum \CD und sind lediglich Näherungswerte. Abweichungen vom 
  gedruckten HKS"~Farbregister und selbst ermittelten Werten sind technisch 
  nicht zu vermeiden.
}%
\index{Farben|)}%
\index{Layout!Farben|?)}%
\end{document}

%
\PrintIndex
\PrintChangelog

\end{document}


\NewDocumentCommand\TestMarkup{s m o d()}{%
  #2[#3](#4)
}

\TestMarkup{aaa}

\TestMarkup{bbb}(ddd)

\TestMarkup{ccc}[opt](fff)

\TestMarkup{qqq}[xxx]

\bigskip

\let\bla\relax
\def\@TestMarkup#1{%
  #1%\futurelet\bla\@gobble%
}

\let\TestMarkup\@TestMarkup

\edef\bla{aaa \TestMarkup{bbb}(foo)}

\edef\foo{aaa \TestMarkup{vvv}(foo)}

\meaning\bla

\meaning\foo

\edef\halo{\futurelet\bla\@gobble(aaa)}

\meaning\halo

\end{document}
%\makeatletter
%
%%\Processor@NewMarkup+gucke+{Option}
%%
%%\Processor@NewMarkup{\Option{gucke=da}}
%%
%%\Processor@NewMarkup{\Option{gucke}=dort=}
%
%\end{document}

%\begin{Declaration}[v2.00]{\Option{cdfont=\PMisc}(\Bundle{test})}[true]<hallo>%
%\begin{Declaration}[v2.00:test]{\Option{cdafont=\PMisc}}[true]<hallo>%
%\printdeclarationlist%
%\typeout{???????????????????}
%\begin{DeclarationValues}
%\itemval=\PLength=[v2.03:bla]
%  Wird ein Längenwert übergeben, entspricht dies 
%\itemval=\PBoolean=[v2.04]
%  Wird ein Längenwert übergeben, entspricht dies 
%\itemvaltrue*
%  Wird der Option ein Längenwert übergeben, entspricht dies exakt der 
%\end{DeclarationValues}
%\typeout{???????????????????}
%\end{Declaration}%
%\end{Declaration}%
%\typeout{???????????????????}

%\Key{\Macro{bla}}{blubb}=foo=
%
%\Macro{aaa}/bbb=ccc/
%
%\Macro{aaa}/bbb/=ddd=
%
%\begin{Declaration}{\Macro{bla}}
\begin{Declaration}{\Macro{bla/foo=\PMisc}}
\begin{Declaration}{\Macro{bla/foo=bla}}%
\printdeclarationlist%
%%\begin{DeclarationValues}
%%\itemval=\PLength=[v2.03]
%%  Wird ein Längenwert übergeben, entspricht dies 
%%\itemval=\PBoolean=[v2.04]
%%  Wird ein Längenwert übergeben, entspricht dies 
%%\itemvaltrue*
%%  Wird der Option ein Längenwert übergeben, entspricht dies exakt der 
%%\end{DeclarationValues}
\end{Declaration}%
\end{Declaration}%
%\end{Declaration}%

%\Macro{aaa}

%\Option{cdfont=true}
%
%\Option{cdfont=false}
%
%\Macro{hallo+test=something}
%
%\tud@if@idx@exists{tudscr:opt:cdfont=*}{ja}{nein}

%
%das ist
%
%\InlineDeclaration{\Option{parskip=bla}(\Package{koma-script})}
%
%oder sonst
%
%\Option{parskip=false}(\Package{koma-script})
%
%\InlineDeclaration{\Macro{hallo}(\Package{koma-script})}
%
%etwas


%
%\clearpage
%
\PrintIndex
%

\end{document}

\expandafter\meaning\csname r@tudscr:opt:cdfont\endcsname\par
\expandafter\meaning\csname r@tudscr:opt:cdfont=special:misc\endcsname\par

\tud@if@lbl@exists{tudscr:opt:cdfont}{ja}{nein}
\tud@if@lbl@exists{tudscr:opt:cdfont=special:misc}{ja}{nein}

\index{}
%\clearpage
%
%fff
%
%\clearpage

\Option{cdfont=\PMisc}

\Option{cdfaont=\PLength}

\Option{cdfont=\PBoolean}'full'

\blindtext

\begin{Declaration}{\Option{cdtest=\PBoolean}}[true]%
\printdeclarationlist%
\begin{DeclarationValues}
\itemvaltrue*
  Wird der Option ein Längenwert übergeben, entspricht dies exakt der 
\itemval=\PLength=[v2.03]
  Wird ein Längenwert übergeben, entspricht dies 
\end{DeclarationValues}
Hallo
\end{Declaration}%

\Option{cdtest=true}

\Option{cdtest=false}


\Macro{caption}(\Package{koma-script},\Package{caption})


\InlineDeclaration{\Macro{caption}(\Package{koma-script},\Package{caption})}


\end{document}
%
Und jetzt ein bisschen Text \Option{cdfont=false} oder | was

\begin{Declaration}{\Macro{something}[\LParameter]}%
\begin{Declaration}{\Macro{something+key=\PMisc}}[true]%
\printdeclarationlist%
%\begin{DeclarationValues}
%\itemvaltrue*
%  Wird der Option ein Längenwert übergeben, entspricht dies exakt der 
%\itemvalfalse
%  Wird der Option ein Längenwert übergeben, entspricht dies exakt der 
%\end{DeclarationValues}
Hallo
\end{Declaration}%
\end{Declaration}%

Und jetzt ein bisschen Text \Macro{something+key=\PMisc}

\begin{Declaration}[v2.01]{\Environment{contactname}}
\printdeclarationlist%
%
Wie bereits zuvor erläutert, werden diese Bezeichner in der linken respektive 
rechten Spalte im Fuß vor der Ausgabe der eigentlichen Felder gesetzt.
\end{Declaration}

\InlineDeclaration{\Environment{contactname}}

\InlineDeclaration{\Macro{something+bla=\PMisc}}

\end{document}

\begin{Bundle*}{\Class{tudscrposter}}
\begin{Declaration}[v2.01]{\Term{contactname}}
\printdeclarationlist%
%
Wie bereits zuvor erläutert, werden diese Bezeichner in der linken respektive 
rechten Spalte im Fuß vor der Ausgabe der eigentlichen Felder gesetzt.
\end{Declaration}
\end{Bundle*}
%
%\begin{Declaration}[v2.03]{\Term{contactname}}
%\printdeclarationlist%
%%
%Wie bereits zuvor erläutert, werden diese Bezeichner in der linken respektive 
%rechten Spalte im Fuß vor der Ausgabe der eigentlichen Felder gesetzt.
%\end{Declaration}
%
%\begin{Bundle}{\Package{tudscrsupervisor}}
%\begin{Obsolete}{v2.05}{\Term{contactname}}'\Term{contactpersonname}'
%\printdeclarationlist%
%%
%Wie bereits zuvor erläutert, werden diese Bezeichner in der linken respektive 
%rechten Spalte im Fuß vor der Ausgabe der eigentlichen Felder gesetzt.
%\end{Obsolete}
%\end{Bundle}
%
%
%\begin{Declaration'}{\Environment{tudpage}[\LParameter]}
%\begin{Obsolete}{v2.02}{\Key{\Environment{tudpage}}{head=\PMisc}}%
%  '\Key{\Environment{tudpage}}{pagestyle}'
%\begin{Obsolete}{v2.02}{\Key{\Environment{tudpage}}{foot=\PMisc}}%
%  '\Key{\Environment{tudpage}}{pagestyle}'
%\printdeclarationlist%
%%
%Diese beiden Parameter der Umgebung \Environment*{tudpage} wurden in ihrer 
%Funktionalität durch den Parameter \Key*{\Environment{tudpage}}{pagestyle} 
%ersetzt.
%\end{Obsolete}
%\end{Obsolete}
%\end{Declaration'}
%
%\end{document}

%\begin{Declaration}[%
%  v2.03!\Option{cd=bicolor}:%
%    Farbeinsatz nur im Kopf mit farbig abgesetztem Querbalken;
%  v2.03!\Option{cd=fullcolor}:%
%    voller Farbeinsatz mit farbig abgesetztem Querbalken;%
%  v2.04!\Option{cd=barcolor}:nur farbig abgesetzter Querbalken;%
%  v2.07:Überschriften verwenden auch bei \Option{cdfont=false} die 
%Hausschrift,
%  falls das Layout des \CDs nicht mit \Option{cd=false} deaktiviert wurde%
%]{\Option{cd=\PMisc}}[true]
%\begin{Declaration}{\Option{cdvery=\PMisc}}[true]<aaa>
%\printdeclarationlist%
%%
%Mit dieser Option wird festgelegt, ob und wie das \TUDCD im gesamten Dokument 
%verwendet wird. Sie hat Einfluss auf die Ausprägung von Titel"~, Teil"~, und 
%Kapitelseiten sowie die Überschriften der weiteren Gliederungsebenen. Im 
%Layout 
%des \CDs wird auch bei \Option{cdfont=false} die Hausschrift in Überschriften 
%verwendet.
%%
%\begin{values}{\Option{cd}}
%\itemfalse
%  Es wird kein \CD sondern die Gestalt der \KOMAScript-Klassen genutzt.
%\itemtrue*[nocolor/monochrome]
%  Das Layout für Titel"~, Teil- und Kapitelseiten ist im \CD, es wird 
%  schwarze Schrift für Titel sowie Teil- und Kapitelüberschriften verwendet.
%  Die Ausprägung des Seitenkopfes ist abhängig von der Option \Option{cdhead}.
%\item[lightcolor/pale]
%  Die Einstellung entspricht weitestgehend der Option \Option{cd=true}, 
%  allerdings wird die primäre Hausfarbe \Color{HKS41} für den Kopf des 
%  \PageStyle{tudheadings}"=Seitenstils genutzt.
%\item[barcolor]
%  \ChangedAt{v2.04}
%  Zusätzlich zur vorherigen Einstellung wird außerdem der Querbalken farbig 
%  abgesetzt.
%\item[bicolor/bichrome]
%  \ChangedAt{v2.03}
%  Der Kopf wird mit einem farbigen Hintergrund in der Hausfarbe gesetzt, auch 
%  der Querbalken wird farbig hinterlegt. Für die Überschriften wird die 
%  primären Hausfarbe verwendet.
%\item[color]
%  Der Titel sowie Teil- und Kapitelseiten werden allesamt farbig gestaltet, 
%  der Seitenkopf wird in der primären Hausfarbe \Color{HKS41} gesetzt, der 
%  Querbalken erhält Linien als Begrenzung.
%\item[fullcolor/full]
%  \ChangedAt{v2.03}
%  Entspricht der vorherigen Einstellung, allerdings wird der Querbalken nicht 
%  durch Linien begrenzt sondern farbig hinterlegt.
%\end{values}
%\end{Declaration}
%\end{Declaration}

\clearpage

\begin{Declaration}[%
  v2.07:Überschriften verwenden auch bei \Option{cdfont=false} die Hausschrift,
  falls das Layout des \CDs nicht mit \Option{cd=false} deaktiviert wurde%
]{\Option{cdnew=\PMisc}}[true]<aaa>
\begin{Declaration}{\Option{cdverynew=\PMisc}}[true]<aaa>
\printdeclarationlist%
%
Mit dieser Option wird festgelegt, ob und wie das \TUDCD im gesamten Dokument 
verwendet wird. Sie hat Einfluss auf die Ausprägung von Titel"~, Teil"~, und 
Kapitelseiten sowie die Überschriften der weiteren Gliederungsebenen. Im Layout 
des \CDs wird auch bei \Option{cdfont=false} die Hausschrift in Überschriften 
verwendet.
%
\begin{DeclarationValues}%
\itemval[v3.00]=false=
  Es wird kein \CD sondern die Gestalt der \KOMAScript-Klassen genutzt.
%\itemvaltrue*=nocolor/monochrome=
%  Das Layout für Titel"~, Teil- und Kapitelseiten ist im \CD, es wird 
%  schwarze Schrift für Titel sowie Teil- und Kapitelüberschriften verwendet.
%  Die Ausprägung des Seitenkopfes ist abhängig von der Option \Option{cdhead}.
%\itemval=lightcolor/pale=
%  Die Einstellung entspricht weitestgehend der Option \Option{cdnew=true}, 
%  allerdings wird die primäre Hausfarbe \Color{HKS41} für den Kopf des 
%  \PageStyle{tudheadings}"=Seitenstils genutzt.
%\itemval[%
%  v2.04:nur farbig abgesetzter Querbalken%
%]=barcolor=
%  Zusätzlich zur vorherigen Einstellung wird außerdem der Querbalken farbig 
%  abgesetzt.
%\itemval[%
%  v2.03:Farbeinsatz nur im Kopf mit farbig abgesetztem Querbalken%
%]=bicolor/bichrome=
%  Der Kopf wird mit einem farbigen Hintergrund in der Hausfarbe gesetzt, auch 
%  der Querbalken wird farbig hinterlegt. Für die Überschriften wird die 
%  primären Hausfarbe verwendet.
%\itemval=color=
%  Der Titel sowie Teil- und Kapitelseiten werden allesamt farbig gestaltet, 
%  der Seitenkopf wird in der primären Hausfarbe \Color{HKS41} gesetzt, der 
%  Querbalken erhält Linien als Begrenzung.
%\itemval[%
%  v2.03:voller Farbeinsatz mit farbig abgesetztem Querbalken
%]=fullcolor/full=
%  Entspricht der vorherigen Einstellung, allerdings wird der Querbalken nicht 
%  durch Linien begrenzt sondern farbig hinterlegt.
\end{DeclarationValues}
\end{Declaration}
\end{Declaration}

%\clearpage
%
%\Option{cdnew=fullcolor}
%
%\Option{cdverynew=fullcolor}

\clearpage
%\PrintIndex
\PrintChangelog

\end{document}
